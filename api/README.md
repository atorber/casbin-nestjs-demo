# NestJS Casbin æƒé™ç®¡ç†æ¼”ç¤º API

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ï¼Œå±•ç¤º NestJS å’Œ Casbin é›†æˆå®ç°åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ã€‚è¯¥åº”ç”¨æä¾› RESTful API å’Œ OpenAPI (Swagger) æ–‡æ¡£ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” åŸºäº Casbin çš„è§’è‰²è®¿é—®æ§åˆ¶
- ğŸ”‘ JWT èº«ä»½è®¤è¯
- ğŸ“š OpenAPI (Swagger) æ–‡æ¡£
- âœ¨ è¾“å…¥éªŒè¯
- ğŸ¯ TypeScript æ”¯æŒ
- ğŸ”„ å®æ—¶æƒé™æ›´æ–°
- ğŸ§ª å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- ğŸ“Š å­˜å‚¨ç®¡ç†ç³»ç»Ÿï¼ˆå®ä¾‹ã€è·¯å¾„ã€æƒé™ï¼‰
- ğŸ‘¥ ç”¨æˆ·å’Œè§’è‰²ç®¡ç†
- ğŸ” æ‰¹é‡æƒé™æ“ä½œæ”¯æŒ

## å‰ç½®è¦æ±‚

- Node.js (v18.x æˆ–æ›´é«˜ç‰ˆæœ¬)
- npm (v10.x æˆ–æ›´é«˜ç‰ˆæœ¬)
- SQLite (å·²åŒ…å«)

## å®‰è£…

1. å®‰è£…ä¾èµ–ï¼š
```bash
npm install
```

2. å¤åˆ¶ `.env.example` æ–‡ä»¶åˆ° `.env` å¹¶æ›´æ–°å€¼ï¼š
```bash
cp .env.example .env
```

## è¿è¡Œåº”ç”¨

### å¼€å‘æ¨¡å¼
```bash
npm run start:dev
```

### ç”Ÿäº§æ¨¡å¼
```bash
npm run build
npm run start:prod
```

## API æ–‡æ¡£

åº”ç”¨è¿è¡Œåï¼Œæ‚¨å¯ä»¥åœ¨ä»¥ä¸‹åœ°å€è®¿é—® Swagger æ–‡æ¡£ï¼š
http://localhost:8000/api-docs

## å¯ç”¨è„šæœ¬

```bash
# å¼€å‘
npm run start:dev

# æ„å»º
npm run build

# ç”Ÿäº§
npm run start:prod

# åˆ›å»ºåˆå§‹ç”¨æˆ·
npm run create:users

# æµ‹è¯•
npm run test

# æµ‹è¯•è¦†ç›–ç‡
npm run test:cov

# ç›‘å¬æ¨¡å¼æµ‹è¯•
npm run test:watch

# è°ƒè¯•æµ‹è¯•
npm run test:debug

# ç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e
```

## ğŸ§ª æµ‹è¯•

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½æ­£ç¡®æ€§ã€‚

### æµ‹è¯•è¦†ç›–æ¨¡å—

- **å­˜å‚¨æ¨¡å—** (`src/storage/`) - å­˜å‚¨å®ä¾‹ã€è·¯å¾„å’Œæƒé™ç®¡ç†
- **ç”¨æˆ·æ¨¡å—** (`src/users/`) - ç”¨æˆ·CRUDæ“ä½œå’Œè§’è‰²ç®¡ç†
- **è®¤è¯æ¨¡å—** (`src/auth/`) - ç”¨æˆ·æ³¨å†Œã€ç™»å½•å’ŒJWTå¤„ç†
- **åº”ç”¨æ¨¡å—** (`src/app.controller.ts`) - åŸºæœ¬åº”ç”¨æ§åˆ¶å™¨

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
npm test -- --testPathPattern=storage
npm test -- --testPathPattern=users
npm test -- --testPathPattern=auth

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- --testPathPattern=app.controller.spec.ts

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
npm run test:watch

# è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:debug
```

### æµ‹è¯•ç»Ÿè®¡

- **æµ‹è¯•æ–‡ä»¶**: 7ä¸ª
- **æµ‹è¯•ç”¨ä¾‹**: 50+ä¸ª
- **è¦†ç›–ç‡**: åŒ…å«æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æƒ…å†µ
- **æµ‹è¯•ç±»å‹**: å•å…ƒæµ‹è¯•ã€Mockæµ‹è¯•

### æµ‹è¯•æœ€ä½³å®è·µ

- ä½¿ç”¨Jestä½œä¸ºæµ‹è¯•æ¡†æ¶
- Mockå¤–éƒ¨ä¾èµ–ï¼ˆæ•°æ®åº“ã€æœåŠ¡ç­‰ï¼‰
- æµ‹è¯•è¦†ç›–æˆåŠŸå’Œå¤±è´¥åœºæ™¯
- ä¿æŒæµ‹è¯•ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ auth/              # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ *.spec.ts     # è®¤è¯æ¨¡å—æµ‹è¯•
â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ *.spec.ts     # ç”¨æˆ·æ¨¡å—æµ‹è¯•
â”œâ”€â”€ storage/           # å­˜å‚¨ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ *.spec.ts     # å­˜å‚¨æ¨¡å—æµ‹è¯•
â”œâ”€â”€ casbinconfig/      # Casbin é…ç½®
â”œâ”€â”€ config/            # åº”ç”¨é…ç½®
â”œâ”€â”€ scripts/           # æ•°æ®åˆå§‹åŒ–è„šæœ¬
â””â”€â”€ main.ts           # åº”ç”¨å…¥å£ç‚¹
test/
â”œâ”€â”€ setup.ts          # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â””â”€â”€ jest-e2e.json     # ç«¯åˆ°ç«¯æµ‹è¯•é…ç½®
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](../LICENSE) æ–‡ä»¶ã€‚
